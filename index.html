<html>
  <head>
    <title>Cloaked Nemesis!</title>
    <script src="/static/js/require-kernel.js"></script>
    <script src="/static/js/jquery-1.9.0.min.js"></script>
    <script src="/static/js/jquery-queryParser.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/static/js/collie.min.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/game.css">
  </head>
  <body>
    <div id="game">
      <div id="messages">
        <div id="log"></div>
        <div id="chat">
          <label for="chat-txt">Nachricht: </label>
          <input type="text" name="chat-txt" id="chat-txt"/>
        </div>
      </div>
    </div>
    <div id="login">
      <h1 id="login-game-title">Cloaked-Nemesis</h1>
      <span id="login-title">Login</span>
      <label for="login-nickname">Nickname:</label>
      <input type="text" name="login-nickname" id="login-nickname"/><br>
      <button type="button" id="login-btn">Login!</button>
    </div>

    <script>
      if(navigator.userAgent.toLowerCase().indexOf('chrome') == -1)
      {
        $('#login').width($('#login').width() + 25);
        $('#login-btn').css('margin-right', 2);
      }

      require.setLibraryURI('/static/js');
      require.setRootURI('http://' + window.location.hostname + ':' + window.location.port);
      
      var game = require('game.js');
      game.init();

      $('#chat-txt').keypress(function (e)
        {
          if (e.which == 13)
          {
            e.preventDefault();

            if($('#chat-txt').val().length != 0)
            {
              game.sendChatMessage($('#chat-txt').val());
              $('#chat-txt').val('');
            }

            return false;
          }
        });

      if($.getQuery().nick)
      {
        $('#login').hide();
        $('#game').show();
        setTimeout(function () { game.start($.getQuery().nick); }, 500);
      }
      else
      {
        $("#login-btn").click(connect);
        $("#login-nickname").keypress(function (e)
        {
          if (e.which == 13)
          {
            e.preventDefault();
            connect();
            return false;
          }
        });

        function connect()
        {
          var nickname = $("#login-nickname").val();

          if(!nickname.match(/^[a-zA-ZüäöÜÄÖß]+$/))
          {
            $("label[for=login-nickname]").css('color', 'red');
            return;
          }
          $("label[for=login-nickname]").css('color', '');

          $('#login-game-title').fadeOut(1000);
          setTimeout(function()
            {
              $('#login').fadeOut(500, function ()
                {
                  $('#game').fadeIn(300);
                });
            }, 650);

          game.start(nickname);
        }
      }
    </script>
  </body>
</html>
